<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Click Simulator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow-x: hidden;
      font-family: 'Inter', sans-serif;
    }
    .particle {
      position: absolute;
      pointer-events: none;
      transition: all 0.8s ease;
      opacity: 0;
      animation: particleFade 0.8s ease-out;
    }
    @keyframes particleFade {
      0% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    }
    .click-button {
      transition: transform 0.1s ease, box-shadow 0.2s ease;
    }
    .click-button:hover {
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    }
    .click-button:active {
      transform: scale(0.95);
    }
    .combo-animation {
      animation: combo-pop 0.5s ease;
      text-shadow: 0 0 10px rgba(255, 255, 0, 0.8);
    }
    @keyframes combo-pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .error-boundary {
      background: rgba(255, 75, 75, 0.3);
      padding: 24px;
      border-radius: 12px;
      text-align: center;
    }
    .card {
      background: rgba(31, 41, 55, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }
    .glow {
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
    }
    .shop-item {
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    .shop-item:hover {
      border-color: #3b82f6;
      transform: scale(1.02);
    }
    .shop-item.affordable {
      border-color: #10b981;
    }
    .achievement-item {
      transition: all 0.3s ease;
    }
    .achievement-item.unlocked {
      animation: unlock-glow 1s ease-in-out;
    }
    @keyframes unlock-glow {
      0%, 100% { box-shadow: 0 0 5px #10b981; }
      50% { box-shadow: 0 0 20px #10b981; }
    }
    .progress-bar {
      background: rgba(75, 85, 99, 0.5);
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-fill {
      transition: width 0.5s ease;
      background: linear-gradient(90deg, #3b82f6, #10b981);
      height: 8px;
      border-radius: 10px;
    }
    .leaderboard-rank {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .modal {
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
    }
    .modal-content {
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white min-h-screen">
  <div id="root"></div>

  <script type="text/javascript">
    const { useState, useEffect, useCallback, useRef } = React;
    const Recharts = window.Recharts || {};
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = Recharts;

    class ErrorBoundary extends React.Component {
      state = { hasError: false, error: null };
      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }
      render() {
        if (this.state.hasError) {
          return React.createElement("div", { className: "error-boundary max-w-md mx-auto mt-8" },
            React.createElement("h2", { className: "text-2xl font-bold mb-2" }, "Oops, something broke!"),
            React.createElement("p", { className: "text-red-200 mb-4" }, this.state.error ? this.state.error.message : "Unknown error"),
            React.createElement("p", { className: "text-sm mb-4" }, this.state.error && this.state.error.message.includes("Recharts") ? "Chart failed to load. Try refreshing the page." : ""),
            React.createElement("button", {
              onClick: () => window.location.reload(),
              className: "bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold transition-colors"
            }, "Reload Page")
          );
        }
        return this.props.children;
      }
    }

    const Particle = ({ x, y, color, size }) => {
      return React.createElement("div", {
        className: "particle rounded-full",
        style: {
          left: x,
          top: y,
          backgroundColor: color,
          width: size,
          height: size,
          transform: "translate(-50%, -50%)"
        }
      });
    };

    const Modal = ({ isOpen, onClose, title, children }) => {
      if (!isOpen) return null;
      return React.createElement("div", { 
        className: "fixed inset-0 z-50 flex items-center justify-center p-4 modal",
        onClick: onClose 
      },
        React.createElement("div", { 
          className: "modal-content p-6 rounded-xl max-w-md w-full max-h-[80vh] overflow-y-auto",
          onClick: e => e.stopPropagation()
        },
          React.createElement("div", { className: "flex justify-between items-center mb-4" },
            React.createElement("h3", { className: "text-xl font-bold" }, title),
            React.createElement("button", { 
              onClick: onClose, 
              className: "text-gray-400 hover:text-white text-2xl" 
            }, "×")
          ),
          children
        )
      );
    };

    const AchievementItem = ({ achievement, totalClicks, cps }) => {
      const progress = Math.min(100, (Math.max(totalClicks, cps) / achievement.requirement) * 100);
      const isUnlocked = achievement.unlocked;
      return React.createElement("div", { 
        key: achievement.id,
        className: `achievement-item p-4 rounded-lg mb-3 border-2 ${isUnlocked ? 'border-green-500 bg-green-900/30' : 'border-gray-700 bg-gray-900'} transition-all duration-300`
      },
        React.createElement("div", { className: "flex items-center mb-2" },
          React.createElement("span", { className: "text-2xl mr-3" }, achievement.icon),
          React.createElement("div", null,
            React.createElement("h4", { className: "font-semibold text-lg" }, achievement.name),
            React.createElement("p", { className: "text-sm text-gray-400" }, achievement.description)
          )
        ),
        React.createElement("div", { className: "mb-2" },
          React.createElement("div", { className: "flex justify-between text-sm mb-1" },
            React.createElement("span", null, `Progress: ${Math.floor(progress)}%`),
            React.createElement("span", null, `Reward: ${achievement.reward} 💰`)
          ),
          React.createElement("div", { className: "progress-bar" },
            React.createElement("div", { 
              className: "progress-fill", 
              style: { width: `${progress}%` } 
            })
          )
        ),
        isUnlocked ? React.createElement("span", { className: "inline-block px-3 py-1 bg-green-600 text-xs rounded-full" }, "Unlocked! 🎉") : null
      );
    };

    const ShopItem = ({ powerUp, money, onBuy, themeColors }) => {
      const isAffordable = money >= powerUp.cost;
      const itemColor = themeColors[Math.floor(Math.random() * themeColors.length)];
      const nextCost = powerUp.cost * (1 + powerUp.owned * 0.1); // Cost increases with levels
      return React.createElement("div", { 
        className: `shop-item p-4 rounded-xl border-2 ${isAffordable ? 'affordable' : ''} bg-gray-900/50 transition-all duration-300`
      },
        React.createElement("div", { className: "flex items-center mb-3" },
          React.createElement("span", { className: `text-3xl mr-3 ${itemColor}` }, powerUp.icon),
          React.createElement("div", null,
            React.createElement("h4", { className: "font-bold text-lg" }, powerUp.name),
            React.createElement("p", { className: "text-sm text-gray-400" }, `${powerUp.description} (Level ${powerUp.owned})`)
          )
        ),
        React.createElement("p", { className: "text-sm mb-3 text-gray-500" }, `Next Cost: $${Math.floor(nextCost)}`),
        React.createElement("button", {
          onClick: () => onBuy(powerUp.id),
          disabled: !isAffordable || (powerUp.maxLevel && powerUp.owned >= powerUp.maxLevel),
          className: `w-full py-2 rounded-lg font-semibold transition-colors ${isAffordable ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 cursor-not-allowed'}`
        }, `Buy ($${powerUp.cost})`)
      );
    };

    const LeaderboardItem = ({ entry, index, isGlobal = false }) => {
      const rankColor = index === 0 ? 'text-yellow-400' : index === 1 ? 'text-gray-400' : index === 2 ? 'text-[#cd7f32]' : 'text-white';
      return React.createElement("div", { 
        className: `flex items-center justify-between py-3 px-4 rounded-lg ${index % 2 === 0 ? 'bg-gray-800/50' : 'bg-gray-900/50'}`
      },
        React.createElement("div", { className: "flex items-center" },
          React.createElement("span", { className: `leaderboard-rank text-2xl mr-3 font-bold` }, index + 1),
          React.createElement("span", null, entry.name)
        ),
        React.createElement("span", { className: `${rankColor} font-bold` }, `${entry.score.toLocaleString()} Clicks`)
      );
    };

    const ClickSimulator = () => {
      const [clicks, setClicks] = useState(() => parseInt(localStorage.getItem("clicks")) || 0);
      const [totalClicks, setTotalClicks] = useState(() => parseInt(localStorage.getItem("totalClicks")) || 0);
      const [clickPower, setClickPower] = useState(() => parseInt(localStorage.getItem("clickPower")) || 1);
      const [autoClicker, setAutoClicker] = useState(() => parseFloat(localStorage.getItem("autoClicker")) || 0);
      const [cps, setCps] = useState(0);
      const [particles, setParticles] = useState([]);
      const [clickMode, setClickMode] = useState("normal");
      const [prestigeLevel, setPrestigeLevel] = useState(() => parseInt(localStorage.getItem("prestigeLevel")) || 0);
      const [prestigePoints, setPrestigePoints] = useState(() => parseInt(localStorage.getItem("prestigePoints")) || 0);
      const [combo, setCombo] = useState(0);
      const [lastClickTime, setLastClickTime] = useState(Date.now());
      const [showCombo, setShowCombo] = useState(false);
      const [level, setLevel] = useState(() => parseInt(localStorage.getItem("level")) || 1);
      const [experience, setExperience] = useState(() => parseInt(localStorage.getItem("experience")) || 0);
      const [money, setMoney] = useState(() => parseInt(localStorage.getItem("money")) || 0);
      const [gems, setGems] = useState(() => parseInt(localStorage.getItem("gems")) || 0);
      const [theme, setTheme] = useState(() => localStorage.getItem("theme") || "purple");
      const [soundEnabled, setSoundEnabled] = useState(() => localStorage.getItem("soundEnabled") !== "false");
      const [particlesEnabled, setParticlesEnabled] = useState(() => localStorage.getItem("particlesEnabled") !== "false");
      const [clickStreak, setClickStreak] = useState(0);
      const [sessionTime, setSessionTime] = useState(0);
      const [eventActive, setEventActive] = useState(false);
      const [eventMultiplier, setEventMultiplier] = useState(1);
      const [minigameActive, setMinigameActive] = useState(false);
      const [minigameScore, setMinigameScore] = useState(0);
      const [inventory, setInventory] = useState(() => JSON.parse(localStorage.getItem("inventory")) || []);
      const [dailyRewards, setDailyRewards] = useState(() => JSON.parse(localStorage.getItem("dailyRewards")) || []);
      const [showStats, setShowStats] = useState(false);
      const [showInventory, setShowInventory] = useState(false);
      const [activeAbility, setActiveAbility] = useState(null);
      const [abilityCooldown, setAbilityCooldown] = useState(0);
      const [leaderboard, setLeaderboard] = useState(() => JSON.parse(localStorage.getItem("leaderboard")) || []);
      const [saveMessage, setSaveMessage] = useState("");

      // Nâng cấp: Thêm state cho achievements và powerUps với nhiều item hơn
      const [achievements, setAchievements] = useState(() => {
        const saved = localStorage.getItem("achievements");
        const defaultAch = [
          { id: "first_click", name: "First Steps", description: "Make your first click", requirement: 1, unlocked: false, icon: "🎯", reward: 10 },
          { id: "click_100", name: "Century", description: "Reach 100 clicks", requirement: 100, unlocked: false, icon: "🏆", reward: 50 },
          { id: "click_1000", name: "Millennium", description: "Reach 1,000 clicks", requirement: 1000, unlocked: false, icon: "🌟", reward: 200 },
          { id: "click_10000", name: "Master Clicker", description: "Reach 10,000 clicks", requirement: 10000, unlocked: false, icon: "🔥", reward: 1000 },
          { id: "click_100000", name: "Click Legend", description: "Reach 100,000 clicks", requirement: 100000, unlocked: false, icon: "👑", reward: 5000 },
          { id: "cps_10", name: "Speed Demon", description: "Reach 10 CPS", requirement: 10, unlocked: false, icon: "⚡", reward: 500 },
          { id: "prestige_1", name: "Prestige Pioneer", description: "Achieve first prestige", requirement: 1, unlocked: false, icon: "⭐", reward: 1000 }, // New
          { id: "money_1000", name: "Rich Clicker", description: "Earn 1,000 money", requirement: 1000, unlocked: false, icon: "💰", reward: 200 } // New
        ];
        if (saved) {
          const parsed = JSON.parse(saved);
          return defaultAch.map(ach => ({ ...ach, unlocked: parsed.find(p => p.id === ach.id)?.unlocked || false }));
        }
        return defaultAch;
      });

      const [powerUps, setPowerUps] = useState(() => {
        const saved = localStorage.getItem("powerUps");
        const defaultPu = [
          { id: "click_power", name: "Click Power", cost: 50, effect: 1, owned: 0, description: "Increase click power by 1", maxLevel: 50, icon: "💪" },
          { id: "auto_clicker", name: "Auto Clicker", cost: 100, effect: 0.1, owned: 0, description: "Generate clicks automatically", icon: "🤖" },
          { id: "combo_boost", name: "Combo Boost", cost: 200, effect: 0.5, owned: 0, description: "Increase combo multiplier", maxLevel: 20, icon: "🚀" },
          { id: "multiplier", name: "Global Multiplier", cost: 500, effect: 0.2, owned: 0, description: "Boost all clicks by percentage", maxLevel: 10, icon: "✨" }, // New
          { id: "gem_generator", name: "Gem Generator", cost: 300, effect: 0.01, owned: 0, description: "Generate gems over time", icon: "💎" } // New
        ];
        if (saved) {
          const parsed = JSON.parse(saved);
          return defaultPu.map(pu => ({ ...pu, owned: parsed.find(p => p.id === pu.id)?.owned || 0 }));
        }
        return defaultPu;
      });

      // Nâng cấp: Thêm state cho modal achievements
      const [showAchievementsModal, setShowAchievementsModal] = useState(false);

      const buttonRef = useRef(null);
      const particleIdRef = useRef(0);

      const themes = {
        purple: "from-purple-900 via-blue-900 to-indigo-900",
        fire: "from-red-900 via-orange-900 to-yellow-900",
        ice: "from-blue-900 via-cyan-900 to-teal-900",
        nature: "from-green-900 via-emerald-900 to-lime-900"
      };

      const themeColors = {
        purple: ["bg-purple-400", "bg-blue-400", "bg-indigo-400", "bg-pink-400"],
        fire: ["bg-red-400", "bg-orange-400", "bg-yellow-400", "bg-amber-400"],
        ice: ["bg-blue-400", "bg-cyan-400", "bg-teal-400", "bg-sky-400"],
        nature: ["bg-green-400", "bg-emerald-400", "bg-lime-400", "bg-green-500"]
      };

      const playSound = useCallback(() => {
        if (soundEnabled) {
          const audio = new Audio("https://freesound.org/data/previews/171/171671_2437358-lq.mp3");
          audio.play().catch(err => console.error("Audio playback failed:", err));
        }
      }, [soundEnabled]);

      const createParticle = useCallback((clientX, clientY) => {
        if (!particlesEnabled) return;
        const colors = themeColors[theme];
        const newParticle = {
          id: particleIdRef.current++,
          x: clientX,
          y: clientY,
          color: colors[Math.floor(Math.random() * colors.length)],
          size: Math.random() * 20 + 10,
          velocity: { x: (Math.random() - 0.5) * 5, y: (Math.random() - 0.5) * 5 },
          lifetime: 800
        };
        setParticles(prev => [...prev, newParticle]);
        setTimeout(() => {
          setParticles(prev => prev.filter(p => p.id !== newParticle.id));
        }, newParticle.lifetime);
      }, [particlesEnabled, theme]);

      const handleClick = useCallback((e) => {
        try {
          playSound();
          createParticle(e.clientX, e.clientY);
          const currentTime = Date.now();
          const timeDiff = currentTime - lastClickTime;
          const clickValue = clickMode === "turbo" ? clickPower * 2 : clickPower;
          setClicks(prev => prev + clickValue);
          setTotalClicks(prev => prev + clickValue);
          setMoney(prev => prev + clickValue);
          setExperience(prev => prev + clickValue);
          if (timeDiff < 1000) {
            setCombo(prev => prev + 1);
            setShowCombo(true);
            setTimeout(() => setShowCombo(false), 1000);
          } else {
            setCombo(0);
          }
          setLastClickTime(currentTime);
          checkAchievements();
        } catch (err) {
          console.error("Error in handleClick:", err);
        }
      }, [clickPower, clickMode, lastClickTime, playSound, createParticle]);

      const checkAchievements = useCallback(() => {
        setAchievements(prev => prev.map(achievement => {
          if (!achievement.unlocked) {
            const progress = Math.max(totalClicks, cps);
            if (progress >= achievement.requirement) {
              setMoney(prevMoney => prevMoney + achievement.reward);
              return { ...achievement, unlocked: true };
            }
          }
          return achievement;
        }));
      }, [totalClicks, cps]);

      const buyPowerUp = useCallback((powerUpId) => {
        try {
          const powerUp = powerUps.find(pu => pu.id === powerUpId);
          if (!powerUp || money < powerUp.cost || (powerUp.maxLevel && powerUp.owned >= powerUp.maxLevel)) return;
          setMoney(prev => prev - powerUp.cost);
          setPowerUps(prev => prev.map(pu => {
            if (pu.id === powerUpId) {
              const newOwned = pu.owned + 1;
              if (powerUpId === "click_power") setClickPower(prev => prev + pu.effect);
              if (powerUpId === "auto_clicker") setAutoClicker(prev => prev + pu.effect);
              if (powerUpId === "combo_boost") setClickPower(prev => prev + pu.effect);
              if (powerUpId === "multiplier") setClickPower(prev => prev * (1 + pu.effect));
              if (powerUpId === "gem_generator") setGems(prev => prev + 1);
              return { ...pu, owned: newOwned };
            }
            return pu;
          }));
          // Animation feedback
          setSaveMessage(`Bought ${powerUp.name}! Level up!`);
          setTimeout(() => setSaveMessage(""), 2000);
        } catch (err) {
          console.error("Error in buyPowerUp:", err);
        }
      }, [money, powerUps]);

      const handlePrestige = useCallback(() => {
        if (clicks >= 1000 && window.confirm("Are you sure you want to prestige? This will reset your progress for prestige points!")) {
          const newPoints = Math.floor(clicks / 1000);
          setPrestigePoints(prev => prev + newPoints);
          setPrestigeLevel(prev => prev + 1);
          setLeaderboard(prev => [...prev, { name: `Player${prestigeLevel + 1}`, score: totalClicks }].sort((a, b) => b.score - a.score).slice(0, 10));
          setClicks(0);
          setClickPower(1);
          setAutoClicker(0);
          setMoney(0);
          setExperience(0);
          setLevel(1);
          setPowerUps(prev => prev.map(pu => ({ ...pu, owned: 0 })));
          setAchievements(prev => prev.map(ach => ({ ...ach, unlocked: false })));
          saveGame();
        }
      }, [clicks, prestigeLevel, totalClicks]);

      const resetGame = useCallback(() => {
        if (window.confirm("Are you sure you want to reset all progress? This cannot be undone!")) {
          setClicks(0);
          setTotalClicks(0);
          setClickPower(1);
          setAutoClicker(0);
          setPrestigeLevel(0);
          setPrestigePoints(0);
          setLevel(1);
          setExperience(0);
          setMoney(0);
          setGems(0);
          setTheme("purple");
          setSoundEnabled(true);
          setParticlesEnabled(true);
          setInventory([]);
          setDailyRewards([]);
          setLeaderboard([]);
          setPowerUps(prev => prev.map(pu => ({ ...pu, owned: 0 })));
          setAchievements(prev => prev.map(ach => ({ ...ach, unlocked: false })));
          localStorage.clear(); // Clear all localStorage
          setSaveMessage("Game reset successfully!");
          setTimeout(() => setSaveMessage(""), 3000);
        }
      }, []);

      const toggleTheme = useCallback(() => {
        try {
          const themeOrder = ["purple", "fire", "ice", "nature"];
          const currentIndex = themeOrder.indexOf(theme);
          const nextTheme = themeOrder[(currentIndex + 1) % themeOrder.length];
          setTheme(nextTheme);
          localStorage.setItem("theme", nextTheme);
          document.body.className = `bg-gradient-to-br ${themes[nextTheme]} text-white min-h-screen`;
        } catch (err) {
          console.error("Error in toggleTheme:", err);
        }
      }, [theme]);

      const saveGame = useCallback(() => {
        try {
          const gameData = {
            version: "1.1.0",
            clicks,
            totalClicks,
            clickPower,
            autoClicker,
            prestigeLevel,
            prestigePoints,
            level,
            experience,
            money,
            gems,
            theme,
            soundEnabled,
            particlesEnabled,
            inventory,
            dailyRewards,
            leaderboard,
            achievements,
            powerUps
          };
          localStorage.setItem("clickSimulatorData", JSON.stringify(gameData));
          localStorage.setItem("achievements", JSON.stringify(achievements));
          localStorage.setItem("powerUps", JSON.stringify(powerUps));
          localStorage.setItem("clickSimulatorBackup", JSON.stringify(gameData));
          // Auto-save message removed to reduce clutter
        } catch (error) {
          console.error("Error in saveGame:", error);
        }
      }, [clicks, totalClicks, clickPower, autoClicker, prestigeLevel, prestigePoints, level, experience, money, gems, theme, soundEnabled, particlesEnabled, inventory, dailyRewards, leaderboard, achievements, powerUps]);

      const loadGame = useCallback(() => {
        try {
          const savedData = localStorage.getItem("clickSimulatorData");
          if (savedData) {
            const data = JSON.parse(savedData);
            if (data.version && data.version.startsWith("1.")) {
              setClicks(data.clicks || 0);
              setTotalClicks(data.totalClicks || 0);
              setClickPower(data.clickPower || 1);
              setAutoClicker(data.autoClicker || 0);
              setPrestigeLevel(data.prestigeLevel || 0);
              setPrestigePoints(data.prestigePoints || 0);
              setLevel(data.level || 1);
              setExperience(data.experience || 0);
              setMoney(data.money || 0);
              setGems(data.gems || 0);
              setTheme(data.theme || "purple");
              setSoundEnabled(data.soundEnabled !== false);
              setParticlesEnabled(data.particlesEnabled !== false);
              setInventory(data.inventory || []);
              setDailyRewards(data.dailyRewards || []);
              setLeaderboard(data.leaderboard || []);
              setAchievements(data.achievements || achievements.map(a => ({ ...a, unlocked: false })));
              setPowerUps(data.powerUps || powerUps.map(p => ({ ...p, owned: 0 })));
              checkAchievements();
              setSaveMessage("Game loaded successfully!");
              setTimeout(() => setSaveMessage(""), 3000);
            } else {
              setSaveMessage("Incompatible save version. Try loading backup.");
              setTimeout(() => setSaveMessage(""), 3000);
            }
          } else {
            setSaveMessage("No saved game found.");
            setTimeout(() => setSaveMessage(""), 3000);
          }
        } catch (error) {
          setSaveMessage(`Failed to load game: ${error.message}`);
          setTimeout(() => setSaveMessage(""), 3000);
          console.error("Error in loadGame:", error);
        }
      }, []);

      const loadBackup = useCallback(() => {
        try {
          const backupData = localStorage.getItem("clickSimulatorBackup");
          if (backupData) {
            const data = JSON.parse(backupData);
            setClicks(data.clicks || 0);
            setTotalClicks(data.totalClicks || 0);
            setClickPower(data.clickPower || 1);
            setAutoClicker(data.autoClicker || 0);
            setPrestigeLevel(data.prestigeLevel || 0);
            setPrestigePoints(data.prestigePoints || 0);
            setLevel(data.level || 1);
            setExperience(data.experience || 0);
            setMoney(data.money || 0);
            setGems(data.gems || 0);
            setTheme(data.theme || "purple");
            setSoundEnabled(data.soundEnabled !== false);
            setParticlesEnabled(data.particlesEnabled !== false);
            setInventory(data.inventory || []);
            setDailyRewards(data.dailyRewards || []);
            setLeaderboard(data.leaderboard || []);
            setAchievements(data.achievements || achievements.map(a => ({ ...a, unlocked: false })));
            setPowerUps(data.powerUps || powerUps.map(p => ({ ...p, owned: 0 })));
            checkAchievements();
            setSaveMessage("Backup loaded successfully!");
            setTimeout(() => setSaveMessage(""), 3000);
          } else {
            setSaveMessage("No backup found.");
            setTimeout(() => setSaveMessage(""), 3000);
          }
        } catch (error) {
          setSaveMessage(`Failed to load backup: ${error.message}`);
          setTimeout(() => setSaveMessage(""), 3000);
          console.error("Error in loadBackup:", error);
        }
      }, []);

      // Nâng cấp: Thêm fake global leaderboard
      const globalLeaderboard = [
        { name: "ProClicker", score: 1500000 },
        { name: "ClickMaster", score: 1200000 },
        { name: "Speedy", score: 900000 },
        { name: "You", score: totalClicks }, // Add player
        { name: "Newbie", score: 50000 }
      ].sort((a, b) => b.score - a.score).slice(0, 5);

      const statsData = [
        { name: "Clicks", value: totalClicks },
        { name: "Money", value: money },
        { name: "Level", value: level },
        { name: "Prestige", value: prestigeLevel }
      ];

      useEffect(() => {
        const autoClick = setInterval(() => {
          if (autoClicker > 0) {
            const autoValue = autoClicker * eventMultiplier;
            setClicks(prev => prev + autoValue);
            setTotalClicks(prev => prev + autoValue);
            setMoney(prev => prev + autoValue);
            setExperience(prev => prev + autoValue);
          }
        }, 1000);
        return () => clearInterval(autoClick);
      }, [autoClicker, eventMultiplier]);

      useEffect(() => {
        const cpsInterval = setInterval(() => {
          setCps(clicks);
          setClicks(0);
        }, 1000);
        return () => clearInterval(cpsInterval);
      }, []);

      useEffect(() => {
        const sessionTimer = setInterval(() => {
          setSessionTime(prev => prev + 1);
        }, 1000);
        return () => clearInterval(sessionTimer);
      }, []);

      useEffect(() => {
        const saveInterval = setInterval(saveGame, 5000);
        return () => clearInterval(saveInterval);
      }, [saveGame]);

      useEffect(() => {
        document.body.className = `bg-gradient-to-br ${themes[theme]} text-white min-h-screen`;
      }, [theme]);

      return React.createElement("div", { className: "p-4 sm:p-8 max-w-7xl mx-auto" },
        // Header
        React.createElement("div", { className: "flex flex-col sm:flex-row justify-between items-center mb-8" },
          React.createElement("h1", { className: "text-4xl font-extrabold tracking-tight" }, "Click Simulator"),
          React.createElement("div", { className: "flex flex-wrap gap-3 mt-4 sm:mt-0" },
            React.createElement("button", {
              onClick: toggleTheme,
              className: "bg-gray-800 hover:bg-gray-700 px-5 py-2 rounded-lg font-semibold transition-colors"
            }, "Change Theme"),
            React.createElement("button", {
              onClick: () => setSoundEnabled(!soundEnabled),
              className: "bg-gray-800 hover:bg-gray-700 px-5 py-2 rounded-lg font-semibold transition-colors"
            }, soundEnabled ? "Mute Sound" : "Enable Sound"),
            React.createElement("button", {
              onClick: () => setParticlesEnabled(!particlesEnabled),
              className: "bg-gray-800 hover:bg-gray-700 px-5 py-2 rounded-lg font-semibold transition-colors"
            }, particlesEnabled ? "Disable Particles" : "Enable Particles"),
            React.createElement("button", {
              onClick: saveGame,
              className: "bg-blue-600 hover:bg-blue-700 px-5 py-2 rounded-lg font-semibold transition-colors"
            }, "Save Game"),
            React.createElement("button", {
              onClick: loadGame,
              className: "bg-blue-600 hover:bg-blue-700 px-5 py-2 rounded-lg font-semibold transition-colors"
            }, "Load Game"),
            React.createElement("button", {
              onClick: loadBackup,
              className: "bg-yellow-600 hover:bg-yellow-700 px-5 py-2 rounded-lg font-semibold transition-colors"
            }, "Load Backup"),
            React.createElement("button", {
              onClick: resetGame,
              className: "bg-red-600 hover:bg-red-700 px-5 py-2 rounded-lg font-semibold transition-colors"
            }, "Reset Game")
          )
        ),
        saveMessage ? React.createElement("div", { className: "card p-4 rounded-xl mb-6 text-center text-lg font-semibold bg-blue-900/50" }, saveMessage) : null,

        // Main Grid
        React.createElement("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6" },
          // Stats Card
          React.createElement("div", { className: "card p-6 rounded-xl col-span-1 lg:col-span-1" },
            React.createElement("h2", { className: "text-2xl font-bold mb-4" }, "Stats"),
            React.createElement("div", { className: "space-y-2 text-lg" },
              React.createElement("p", null, "Clicks: ", clicks.toFixed(0)),
              React.createElement("p", null, "Total Clicks: ", totalClicks.toLocaleString()),
              React.createElement("p", null, "Money: $", money.toLocaleString()),
              React.createElement("p", null, "Gems: ", gems),
              React.createElement("p", null, "Level: ", level),
              React.createElement("p", null, "Experience: ", experience.toFixed(0)),
              React.createElement("p", null, "Click Power: ", clickPower.toFixed(1)),
              React.createElement("p", null, "Auto Clicker: ", autoClicker.toFixed(1), " CPS"),
              React.createElement("p", null, "Prestige Level: ", prestigeLevel),
              React.createElement("p", null, "Prestige Points: ", prestigePoints),
              React.createElement("p", null, "Session Time: ", Math.floor(sessionTime / 60), "m ", (sessionTime % 60), "s")
            )
          ),

          // Click Button
          React.createElement("div", { className: "card p-6 rounded-xl text-center col-span-1 lg:col-span-1" },
            React.createElement("button", {
              ref: buttonRef,
              onClick: handleClick,
              className: "click-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 px-10 rounded-full text-3xl glow mb-4"
            }, "Click Me!"),
            showCombo && combo > 1 ? React.createElement("div", {
              className: "combo-animation text-yellow-300 text-3xl font-bold"
            }, combo + "x Combo!") : null,
            particles.map(particle => React.createElement(Particle, { key: particle.id, x: particle.x, y: particle.y, color: particle.color, size: particle.size }))
          ),

          // Shop (Nâng cấp: Grid layout, more items, dynamic cost)
          React.createElement("div", { className: "card p-6 rounded-xl col-span-1 lg:col-span-1" },
            React.createElement("h2", { className: "text-2xl font-bold mb-4" }, "Shop"),
            React.createElement("div", { className: "grid grid-cols-1 gap-4 max-h-96 overflow-y-auto" },
              powerUps.map(powerUp => React.createElement(ShopItem, { 
                key: powerUp.id, 
                powerUp, 
                money, 
                onBuy: buyPowerUp, 
                themeColors: themeColors[theme] 
              }))
            ),
            React.createElement("button", {
              onClick: handlePrestige,
              disabled: clicks < 1000,
              className: "bg-red-600 hover:bg-red-700 px-5 py-3 rounded-lg mt-4 w-full font-semibold transition-colors disabled:opacity-50"
            }, "Prestige (Requires 1000 Clicks)")
          )
        ),

        // Achievements (Nâng cấp: Button to open modal with progress bars)
        React.createElement("div", { className: "card p-6 rounded-xl mb-6" },
          React.createElement("div", { className: "flex justify-between items-center" },
            React.createElement("h2", { className: "text-2xl font-bold" }, "Achievements"),
            React.createElement("button", {
              onClick: () => setShowAchievementsModal(true),
              className: "bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg font-semibold"
            }, "View All")
          ),
          React.createElement("div", { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4" },
            achievements.slice(0, 3).map(achievement => React.createElement(AchievementItem, {
              key: achievement.id,
              achievement,
              totalClicks,
              cps
            }))
          )
        ),

        // Nâng cấp: Split Leaderboard into Local and Global
        React.createElement("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6" },
          React.createElement("div", { className: "card p-6 rounded-xl" },
            React.createElement("h2", { className: "text-2xl font-bold mb-4" }, "Local Leaderboard"),
            React.createElement("div", { className: "space-y-2" },
              leaderboard.length > 0 ? leaderboard.map((entry, index) => 
                React.createElement(LeaderboardItem, { key: index, entry, index })
              ) : React.createElement("p", { className: "text-gray-400" }, "No entries yet! Click more!")
            )
          ),
          React.createElement("div", { className: "card p-6 rounded-xl" },
            React.createElement("h2", { className: "text-2xl font-bold mb-4" }, "Global Leaderboard"),
            React.createElement("div", { className: "space-y-2" },
              globalLeaderboard.map((entry, index) => 
                React.createElement(LeaderboardItem, { key: index, entry, index, isGlobal: true })
              )
            )
          )
        ),

        // Stats Chart
        React.createElement("div", { className: "card p-6 rounded-xl" },
          React.createElement("h2", { className: "text-2xl font-bold mb-4" }, "Stats Chart"),
          Recharts.BarChart ? React.createElement(ResponsiveContainer, { width: "100%", height: 400 },
            React.createElement(BarChart, { 
              data: statsData, 
              margin: { top: 20, right: 30, left: 20, bottom: 5 } 
            },
              React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: "#444" }),
              React.createElement(XAxis, { dataKey: "name", stroke: "#fff" }),
              React.createElement(YAxis, { stroke: "#fff" }),
              React.createElement(Tooltip, { contentStyle: { backgroundColor: "#1f2937", border: "none", borderRadius: "8px" } }),
              React.createElement(Bar, { dataKey: "value", fill: "#3b82f6", radius: [4, 4, 0, 0] })
            )
          ) : React.createElement("p", { className: "text-red-400" }, "Chart failed to load. Please try refreshing the page.")
        ),

        // Modal for Achievements
        React.createElement(Modal, {
          isOpen: showAchievementsModal,
          onClose: () => setShowAchievementsModal(false),
          title: "All Achievements"
        },
          React.createElement("div", { className: "space-y-4" },
            achievements.map(achievement => React.createElement(AchievementItem, {
              key: achievement.id,
              achievement,
              totalClicks,
              cps
            }))
          )
        )
      );
    };

    try {
      ReactDOM.render(
        React.createElement(ErrorBoundary, null,
          React.createElement(ClickSimulator)
        ),
        document.getElementById("root")
      );
    } catch (err) {
      console.error("Error rendering React app:", err);
    }
  </script>
</body>
</html>
